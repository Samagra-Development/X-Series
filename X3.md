
_Pre-Requisite_ *__Please refer this [link](https://www.metabase.com/docs/latest/users-guide/02-database-basics.html) for a basic refresher on database basics.__*

1. What is Metabase?



# What is Metabase?

An **open-source** basic **Business intelligence** tool to **help visualise** and display your data in a **insightful and user centric manner**

# Why Metabase?

1. Ability to connect different databases
2. Feature set
3. Set of Visualisations offered
4. Open source community
5. Ease of deployment
6. Ease to use GUI (Ease in configuration of database)

# Setting up Metabase locally

## Pre-requisites 

- Docker installed on system. Please refer this [link](https://github.com/Samagra-Development/X-Series/blob/main/X1/InstallationGuide.md) to setup docker on your machine.

## Installing Metabase locally

- Once you have followed the installation steps (i) to (vi) correctly under the [link](https://github.com/Samagra-Development/X-Series/blob/main/X1/InstallationGuide.md), then run following command on your command prompt  
   ```txt
      docker ps
   ```
- Once the command is run, you would see in your logs that metabase engine is running, like in the image mentioned below. *This is the local instance of Metabase that you can use for 
  practising.
  ![image](https://user-images.githubusercontent.com/63345263/132385263-caa9ab07-58e4-48fc-b108-bcd60cb0f793.png)
- Whenever in future, you wish to run the metabase instance, start the docker on your command prompt by going first to the database directory. *(Similar to step-1 above)*, and then running the following
  command
  ```txt
      docker-compose up -d
   ```
- Now open your Chrome and open the following url http://localhost:5003. Metabase GUI should open
  ![image](https://user-images.githubusercontent.com/63345263/132385539-0571631f-04e3-4246-be29-467cab1ce041.png)
-  Set up the metabase with your details and setting the login credentials
-  Once done you will land on the home page.

# Product Walkthrough

## Home Page Overview
![image](https://user-images.githubusercontent.com/63345263/132389131-3189f689-4ed5-43b1-9965-d728ec52bf79.png)
![image](https://user-images.githubusercontent.com/63345263/132389310-3b954a19-c877-4d97-b052-f66cf1ad039c.png)

Following elements are found on the home page

1. Pinned Items
2. Previously collected dashboards and collections
3. A list of the databases you’ve connected to Metabase.

## Menu Features
1. Asking Questions
2. Browsing Data
3. Create Option (Creating a Dashboard/Pulse)
4. Native SQL Query Editor
5. Settings - Admin, Account Settings, Sign out

## Admin Capabilities
1. [Connecting Database](http://localhost:5003/admin/databases)
2. [Caching Databases](http://localhost:5003/admin/settings/caching)
3. [Localisation](http://localhost:5003/admin/settings/localization) and Visualisation settings

# Connecting a Database
1. Go to the Settings Tab
2. On the top of settings tab, Click on *Databases*
3. Click on **Add Database** on the top right, In order to connect the database
4. Inside the form fill the following details
   **DB Type** - PSQL (most of the databases used in Samagra are PSQL)
   **Name** - Descriptor how you want to access the Database later
   **Host** - db (In case of the remote database, enter the IP address of the DB)
   **Port** - 5432 (Port on which the DB running)
   **Database name** - dbname (Name of the database)
   **Username** - user (Wwhat user you use to login to the Database?)
   **Password** - dbpassword (Password to the Database)
 5. Click on Save button at the bottom, you should see a success message. Now you can see the database under the Home tab and also under Browse Data tab.

# Edit Metadata using Data Model
1. Help Save time and cluttering
2. To make changes to your metadata in Metabase, visit the Data Model tab in the Admin Panel. The Data Model tab displays options to edit metadata for the database, tables, and columns. For example, you can edit a column’s name, visibility, type, and description. You can also remap foreign keys to give human readable names to foreign key columns!
3. Here are some ways editing metadata can make life better for your users:
   - When column names are confusing, you can change their names or add a description.
   - If you have address columns, you can hide them from your users to protect privacy.
   - You can pick your preferred filter interface from three options (search box, list of values, or plain input box).
4. **Perhaps the most important piece of metadata you can change is the data type.**

![image](https://user-images.githubusercontent.com/63345263/132396498-3d014706-bc02-4294-9501-765bcb649352.png)

# Asking Questions

## What is a Question?
- A question is essentially a query performed on the data. Think of it as a question you are asking the data – How many students were enrolled district wise, gender wise at a time in the state? 
- Available on the top right side of the home pag
- Many analytics questions can be answered with just four steps:
  - Join a couple of tables to get all the required information in one place.
  - Filter the data so that it only includes the values that are relevant.
  - Group and aggregate those values to create the insight you need.
  - Visualize the result so that you can understand what your data is telling you.
- There are three ways to ask questions: simple, custom, and native queries.

![image](https://user-images.githubusercontent.com/63345263/132398574-4430d1c6-e88c-4913-8690-d9aaf5c00244.png)


## Simple and Custom Questions

- Can be done using GUI

### Simple Questions

- Most basic functionality
- Quick questions directly from Query Builder, Basically *Pick some data, view it, and easily filter, summarize, and visualize it.*
- You pick a metric on which you want to summarise data, and then group over a set of data, and then render the answer.
- For Example - Finding the average rating of the product, average rating of product across categories

#### Steps involved
 - Always involves some **filtering and/or summarising**
 - Filtering - Narrowing down basis some criteria (eg. What category of school?, Elementary or Higher Grades)
      - Just click the Filter button in the top-right of the screen to open the filter sidebar. You’ll see a list of all of the columns in this table, as well as columns from tables that are related to
        the one you’re looking at. Depending on the column you pick, you’ll see slightly different options for your filter. 
  - Summarising - Summarising across a set of metrics (Count, Sum, Average, Deviation)
      - To do this in Metabase, click the Summarize button in the top-right of the screen, and the summary sidebar will open up.
       ![image](https://user-images.githubusercontent.com/63345263/132442005-116245e0-4310-4818-a50d-ff7fc90523ea.png)
      - **Picking Metrics** - The sidebar has two main parts: the top is where you pick the number (“metric”) you want to see, and the part below it is where you pick how to group that number 
                             (or how to “break it out”).
      - You can change this to Count, Average, Distinct values, subtotal
      - **Grouping your metrics** - For example if you want to get average rating for a product category wise, then you will group the average metric under product category.                  
      - When you click on a different grouping column than the one you currently have selected, the grouping will switch to use that column instead. But if you want to add an additional grouping, just click the plus (+) icon on the right side of the column. To remove a grouping, click on the X icon
      - Once you’re done setting your metrics and groupings, click Done to close the Summarize sidebar and see your results in all their glory.
      - In the next step, we will see how to change and generate different visualisations
    
- To Do - 1. Create a Question to show number of products under price $20?
          2. Create a question to show number of products category wise with total price under $20?

### Custom Question

- A question composed using the notebook editor. **Sophisticated version of Simple Question**
  ![image](https://user-images.githubusercontent.com/63345263/132442893-ec016f7b-967f-4f51-904e-033a86c7ee8e.png)
- You can add **custom expressions**, to add basic SQL Functionalities like joining tables, create custom columns, filter and group results, compare time series etc
- Refer this [link](https://www.metabase.com/learn/questions/custom-expressions.html) for more clarity on Custom Questions
- For example - If I want to cappture state wise how many purchases were made, then I will use a custom question
- Checking examples on
   - Custom Column
   - Table Operations (Refer this [link](https://www.geeksforgeeks.org/sql-join-set-1-inner-left-right-and-full-joins/) for refresher on SQL JOIN Operations) [Using JOIN in Metabase](https://www.metabase.com/learn/questions/joins-in-metabase.html)
   - Custom Filters
- Refer this [link](https://www.metabase.com/docs/latest/users-guide/expressions.html) on more clarity on using expressions in notebook editor

### SQL Native Queries

- Sometimes for a complex metric, the custom question may not cater to the requirements, hence in that scenario, Metabase provides native Query Editor to compose questions in SQL

# Visualising Results

## Type of Visualisations

In Metabase, an answer to a question can be visualized in a number of ways:
- Numbers
- Trend
- Progress bar
- Gauge
- Table
- Pivot table
- Line chart
- Bar chart
- Combo chart
- Waterfall chart
- Row chart
- Area chart
- Scatterplot or bubble chart
- Pie/donut chart
- Funnel
- Map

Refer this [link](https://www.metabase.com/docs/latest/users-guide/05-visualizing-results.html) on detailed description of these visualisations. In the scope of the document, we will discuss the most commonly used visualisations used
under the scope of our engagements

## Which visualisation should I use?

**PRIORITY-1 ---- Let Metabase pick the chart for you***

### Case by case discussion 

- **Scenario - 1** Too much data (disparate data bound by a common fields) under one window - **Use Table**
- **Scenario - 2** Provide a downloadable and reviewable visualisation to stakeholder - **Use Table**
  ![image](https://user-images.githubusercontent.com/63345263/132446733-792292d3-0e34-4437-98ba-9f4ed588c2fa.png)
- **Scenario - 3** Data as a time series to see how a particular measure changes over time (like a rolling 7-day average)  - **Use Line Graph**
- ![image](https://user-images.githubusercontent.com/63345263/132446768-30e668d4-0952-42b7-a69e-51b752429a1b.png)
- **Scenario - 3** When you only have one value, a representative value - **Use Number**
  ![image](https://user-images.githubusercontent.com/63345263/132446827-2251791b-16c8-43de-abc5-2d1cefc88c0d.png)
- **Scenario - 4** Show a change in a representative value to stress on the growth or fall - **Use Trend**
  ![image](https://user-images.githubusercontent.com/63345263/132446854-b89ecf76-a30f-4910-ab52-c4c5c944535b.png)
- **Scenario - 5** If you want to see a metric in the context of a goal, or limit, or other threshold - **Use Progress Bar**
  ![image](https://user-images.githubusercontent.com/63345263/132446900-dbdd5d1d-622a-462b-8393-829078b5de1e.png)
- **Scenario - 6** Compare groups of data with just a glance - **Use Bar Chart**
  ![image](https://user-images.githubusercontent.com/63345263/132447073-9c9b146c-3312-494d-92a2-623aa4623e70.png)
- **Scenario - 7** Multiple measures with different scales at one place - **Use Combo Chart**
  ![image](https://user-images.githubusercontent.com/63345263/132447232-1c9a5016-e652-4aa3-8a48-5062a84e3438.png)
- **Scenario - 8** Rendering Breakouts/Comparison - **Use Pie/Donut Charts**
  ![image](https://user-images.githubusercontent.com/63345263/132447310-ea7478ff-60f8-4186-b246-39cca72d9cff.png)
- **Scenario - 9** Categorical Breakout across time or differnet groups - **Use Stacked Charts**
  ![image](https://user-images.githubusercontent.com/63345263/132447428-16542ba2-6450-4e4f-8416-c18fd49d1700.png)
- **Scenario - 10** Data with geographical dimeansions/comparing different regions across set of parameters - **Use Map based Visualisations**

### Deep Dive into Visualisations

1. Tables
2. Bar Charts
3. Line Graph
4. Pie Chart
5. Stacked Charts
6. Map Based Visualisations

Exercises 

(a)
